<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.jsdelivr.net/npm/@polkadot/util@8.3.1/bundle-polkadot-util.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@polkadot/util-crypto@8.3.1/bundle-polkadot-util-crypto.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@polkadot/keyring@8.3.1/bundle-polkadot-keyring.js"></script>

    <style>
        .form-item {
            display: block;
            margin: 32px;
        }
        label{ display: block}
        textarea {
            width: 1024px;
            height: 200px;
        }
        input {
            width: 1024px;
        }
        #progress {
            width: 0%;
            height: 32px;
            background: black;
        }
    </style>
</head>
<body>
<div class="form-item">
    <label>Символы в префиксе:</label>
    <input placeholder="Символы в префиксе" value="qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM0123456789"
           id="prefixChars">
</div>

<div class="form-item">
    <label>Максимальная длина префикса:</label>
    <input placeholder="Максимальная длина префикса" value="2" id="prefixLength">
</div>

<div class="form-item">
    <label>Основа:</label>
    <textarea placeholder="Основа" id="cores">
Risto547315
Risto54731
Risto5473</textarea>
</div>

<div class="form-item">
    <label>Постфиксы:</label>
    <textarea placeholder="Постфиксы" id="suffixes">

?
!
+</textarea>
</div>

<div class="form-item">
    <label>Закодированные данные из кошелька польки:</label>
    <textarea placeholder="Закодированные данные из кошелька польки" id="json">
{"address":"5CqcmstVWDxcggBxHr9Sbr3DSFUNBxBw9TLwDuqjYUH4jRvj","encoded":"NCTUpQLKI9QmtqK9AmWpFaW/N0pAY5SD6UjxlLaV3g4AgAAAAQAAAAgAAAAUqtVIvgpuQHuBHd1IoowZsYan5QQAVZcRh1g+4pMiXd/BMfn507w/qR+KW3QGIZi0eXw4yPBOScBLQNWZc+SyvXIQBRjH95C6E8fEd2KwRBVQOQvW1iWOi76yYVkjvmUiWdcES+nxHbDmTAehLLkuh+YnEKOrcyIZi0Bq39rCWPJIZqLBTDjwnxmSXYrwJygHL2Kax+H0YFy2ge1D","encoding":{"content":["pkcs8","sr25519"],"type":["scrypt","xsalsa20-poly1305"],"version":"3"},"meta":{"genesisHash":null,"isHidden":false,"name":"Eliseev Evgneni","whenCreated":1.617890024711e+12}}</textarea>
</div>

<div class="form-item">
    <div id="progress"></div>
</div>

<div class="form-item">
    <label>Результаты:</label>
    <textarea placeholder="Результаты" id="log" disabled></textarea>
</div>

<div class="form-item">
    <button onclick="main()">Погнали!</button>
</div>

<script>

function restoreAccount (json, password) {
    const kr = new Keyring();
    const cryptoType = Array.isArray(json.encoding.content) ? json.encoding.content[1] : 'ed25519';
    const encType = Array.isArray(json.encoding.type) ? json.encoding.type : [json.encoding.type];
    const pair = createPair(
      { toSS58: kr.encodeAddress, type: cryptoType },
      { publicKey: kr.decodeAddress(json.address, true) },
      json.meta,
      isHex(json.encoded) ? hexToU8a(json.encoded) : base64Decode(json.encoded),
      encType
    );

    pair.decodePkcs8(password);
    return pair;
}

function prefixes(l, prefixChars) {
    if (l < 1) {
        return ['']
    }
    if (l === 1) {
        return prefixChars
    }
    const res = []
    for (const a of prefixChars) {
       for (const b of prefixes(l-1, prefixChars)) {
           res.push(a+b)
       }
    }
    return res
}


function count(prefixLengths, prefixChars, cores, suffixes) {
    let x = 0
    for (const c of cores) {
        for (const l of prefixLengths) {
            for (const p of prefixes(l, prefixChars)) {
                for (const s of suffixes) {
                    x++
                }
            }
        }
    }
    return x;
}

function restorePassword(prefixLengths, prefixChars, cores, suffixes, json, logLines) {
    const n = count(prefixLengths, prefixChars, cores, suffixes)
    let x = 0
    for (const c of cores) {
        for (const l of prefixLengths) {
            for (const p of prefixes(l, prefixChars)) {
                for (const s of suffixes) {
                    x++
                    const pass = p + c + s
                    try {
                        restoreAccount(json, pass)
                        console.log('[+] ' + pass)
                        logLines.push(`[+] [${x}/${n}] ${pass}`)
                        return pass
                    } catch (e) {
                        console.log('[-] ' + pass)
                        logLines.push(`[-] [${x}/${n}] ${pass}`)
                    }
                }
            }
        }
    }
}

async function main() {
    const prefixLength = parseInt(document.querySelector('#prefixLength').value)
    const prefixLengths = [];
    for (let i = 0; i <= prefixLength; i++) {
        prefixLengths.push(i)
    }
    console.log(prefixLengths)

    const prefixChars = [...document.querySelector('#prefixChars').value]
    console.log(prefixChars)

    const cores = document.querySelector('#cores').value.split('\n')
    console.log(cores)

    const suffixes = document.querySelector('#suffixes').value.split('\n')
    console.log(suffixes)

    const json = JSON.parse(document.querySelector('#json').value)
    console.log(json)

    const log = document.querySelector('#log')
    const progress = document.querySelector('#progress')

    const logLines = []

    const pass = await restorePassword(prefixLengths, prefixChars, cores, suffixes, json, logLines)

    log.value = logLines.join('\n')
}

</script>
</body>
</html>